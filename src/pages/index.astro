---
import Layout from "../layouts/Layout.astro";
import MenuCard from "../components/menu/MenuCard.astro";
import { getCollection } from "astro:content";

// 1. Obtenemos toda la colección del menú
const menuFiles = await getCollection("menu");

// 2. "Aplanamos" los datos.
// Como menuFiles trae los archivos (cafes.json), y dentro de cada archivo hay varios platos,
// usamos .flatMap para sacar todos los platos en una sola lista simple.
const todosLosPlatos = menuFiles.flatMap((archivo) => archivo.data);

// Opcional: Filtramos solo los destacados para el Home
const destacados = todosLosPlatos.filter((plato) => plato.destacado);
---

<Layout title="Inicio">
  <section
    class="relative bg-slate-900 py-20 px-4 text-center border-b border-slate-800"
  >
    <div class="max-w-4xl mx-auto">
      <h1
        class="text-5xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-amber-500 to-orange-600 mb-6"
      >
        Cafe Racer Experience
      </h1>
      <p class="text-xl text-slate-300 mb-8">
        Más que café, una parada técnica para el alma motera.
      </p>
      <button
        class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-8 rounded-full transition-colors cursor-pointer"
      >
        Ver Menú Completo
      </button>
    </div>
  </section>

  <main class="max-w-7xl mx-auto px-4 py-16">
    <h2
      class="text-3xl font-bold text-white mb-10 border-l-4 border-amber-500 pl-4"
    >
      Favoritos del Taller
    </h2>

    {
      destacados.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {destacados.map((plato) => (
            <MenuCard
              nombre={plato.nombre}
              descripcion={plato.descripcion}
              precio={plato.precio}
              imagen={plato.imagen}
              etiquetas={plato.etiquetas}
            />
          ))}
        </div>
      ) : (
        <p class="text-slate-400">No hay platos destacados por ahora.</p>
      )
    }

    <div class="mt-20">
      <h2 class="text-2xl text-slate-400 mb-6">Todos nuestros Cafés</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {
          todosLosPlatos.map((plato) => (
            <MenuCard
              nombre={plato.nombre}
              descripcion={plato.descripcion}
              precio={plato.precio}
              imagen={plato.imagen}
              etiquetas={plato.etiquetas}
            />
          ))
        }
      </div>
    </div>
  </main>
</Layout>
